<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
	*변경사항*
	mapper 파일의 완전한 경로 . xml은 생략
	ibatis와는 다르게 id값에 '.'를 사용하지 못함
 -->
<mapper namespace="config.Content">
	<!-- 상세페이지 viewcount -->
	<update id="ContentUpdateViewcount" parameterType="java.util.Map">
		update content set viewcount=viewcount+1 where contentid=#{contentid}
	</update>
	<!-- 상세페이지 좋아요 누를경우  -->
	<insert id="contentInsertLikedTour" parameterType="java.util.Map">
		insert into liked_tour(LIKED_T_ID,ID,CONTENTID)
		values(SEQ_liked_tour_liked_t_id.nextval,#{id}, #{contentid})
	</insert>
	
	<select id="contentIsAlreadyLiked"  parameterType="java.util.Map" resultType="int">
		select count(*) from liked_tour where id=#{id} and contentid=#{contentid}
	</select>
	
	<!--  메인에서 사용하는 tour list -->
	<select id="mainContentList" resultType="java.util.Map">
		select C.*, R.FEQ
		from content c, (select contentid, count(*) as feq from review_content group by contentid order by feq desc) r
		where c.contentid = r.contentid and rownum <![CDATA[<=]]> 6
		order by c.viewcount desc
	</select>
	<!-- 메인에서 사용하는 review list  -->
	<select id="mainReviewList" resultType="java.util.Map">
		select * 
		from (select * from review order by rating desc, liked desc, view_count desc ) t
		where rownum <![CDATA[<=]]> 6
	</select>
	<select id="mainPlannerList" resultType="java.util.Map">
		select * 
		from (select * 
		from planner 
		order by postdate desc, depart desc) t
		where rownum <![CDATA[<=]]> 6
	</select>
</mapper>